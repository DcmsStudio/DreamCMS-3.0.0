/**
 * Created by marcel on 19.04.14.
 */
tinymce.PluginManager.requireLangPack("googlemaps");
tinymce.PluginManager.add("googlemaps",function(d){function g(a){a={maptype:a.mapType.toLowerCase(),center:a.lat+","+a.lon,zoom:a.zoom,size:a.width+"x"+a.height,maptype:a.mapType,markers:a.lat+","+a.lon,sensor:!1,format:"png32",scale:1};"undefined"!=typeof d.getParam("gApiKey")&&(a.key=d.getParam("gApiKey"));var b=[],e;for(e in a)b.push(e+"="+escape(a[e]));return"http://maps.googleapis.com/maps/api/staticmap?"+b.join("&")}function f(a,b){return tinyMCE.DOM.createHTML("img",{width:b.width,height:b.height,
	id:a.id,"data-mce-object":"googlemaps","data-mce-resize":!0,src:a.url,"class":"googlemaps","data-maps":"true","data-options":escape(a.options)})}"undefined"==typeof tinymce.mapID&&(tinymce.mapID=0);d.on("ObjectResized",function(a){if("googlemaps"==a.target.getAttribute("class")){var b=unescape(a.target.getAttribute("data-options")),b=JSON.parse(b);b.width=a.width;b.height=a.height;var e=g(b);a.target.setAttribute("src",e);a.target.setAttribute("data-options",escape(JSON.stringify(b)))}});d.addButton("googlemaps",
	{icon:!0,image:tinyMCE.baseURL+"/plugins/googlemaps/img/map.gif",tooltip:"Create Google Map",stateSelector:["img[data-mce-object=googlemaps]"],onclick:function(){var a=d.selection.getNode(),b={};d.dom.hasClass(a,"googlemaps")&&(d.selection.select(a),b=JSON.parse(unescape(a.getAttribute("data-options"))),a.offsetWidth&&(b.width=a.offsetWidth),a.offsetHeight&&(b.height=a.offsetHeight));b.locationLookupEnabled=!0;b.apiKey=d.getParam("googleapikey");win=d.windowManager.open({title:"Google Maps",file:tinyMCE.baseURL+
		"/plugins/googlemaps/googlemaps.htm",width:640,height:450,inline:1,buttons:[{text:"Insert",subtype:"primary",onclick:function(){var a=d.windowManager.getWindows()[0],b=a.getContentWindow().generateCodeMap(),c=1;do tinymce.mapID="googlemap-"+(c++).toString();while(d.dom.doc.getElementById(tinymce.mapID));b.id=tinymce.mapID;b=f({id:b.id,url:g(b),options:JSON.stringify(b)},b);c=d.selection.getNode();d.dom.hasClass(c,"googlemaps")&&"IMG"==c.tagName&&"googlemaps"===c.getAttribute("data-mce-object")?$(c).replaceWith(b):
		d.insertContent(b);a.close()}},{text:"Close",onclick:"close"}]},b)}});d.on("preInit",function(a,b){return function(){a.serializer.addNodeFilter("img",function(a,b){for(var c=0;c<a.length;c++)a[c].attr("data-options")&&"googlemaps"==a[c].attr("class")&&a[c].replace((new tinyMCE.html.DomParser({validate:!1})).parse('<div class="googlemaps" id="'+a[c].attr("id")+'" data-options="'+a[c].attr("data-options")+'"> &nbsp;- </div>'))});a.parser.addNodeFilter("div",function(a,d){for(var c=0;c<a.length;c++)if(node=
	a[c],"googlemaps"==node.attr("class")&&node.attr("data-options")&&node.attr("data-options")){var f=b({id:node.attr("id"),url:g(JSON.parse(unescape(node.attr("data-options")))),options:unescape(node.attr("data-options"))},JSON.parse(unescape(node.attr("data-options"))));node.replace((new tinyMCE.html.DomParser({validate:!1})).parse(f))}})}}(d,f))});