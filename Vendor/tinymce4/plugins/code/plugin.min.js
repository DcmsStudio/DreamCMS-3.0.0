tinymce.PluginManager.add("code",function(a){function q(){l=a.windowManager.getWindows();if(l.length)return l[l.length-1]}function r(){s||("undefined"!=typeof top?$(top.window.document.body).find("style[rel=tinymceAce]").remove():$(document).find("style[rel=tinymceAce]").remove(),s=!0)}function t(d,c){if($("#htmlSource").lenght&&$("#htmlSource").data("ace")){var b=$("#htmlSource").data("ace").getValue();c.data.code=b}}function n(){a.windowManager.open({title:"Source code",padding:0,x:0,y:0,body:{type:"textbox",
	name:"code",id:"htmlSource",multiline:!0,minWidth:a.getParam("code_dialog_width",800),minHeight:a.getParam("code_dialog_height",Math.min(tinymce.DOM.getViewPort().h-200,500)),value:a.getContent(),spellcheck:!1,style:"direction: ltr; text-align: left",padding:0,x:0,y:0},onSubmit:function(d){a.focus();t(a,d);r();a.setContent(d.data.code);a.undoManager.transact(function(){a.setContent(d.data.code)});a.selection.setCursorLocation();a.nodeChanged()}});setTimeout(function(){u();$("#htmlSource").parents("div.mce-window:last").resizable({minHeight:400,
	minWidth:500,resize:function(d,c){var b=$(this).find(".mce-window-head").outerHeight(!0)+$(this).find(".mce-foot").outerHeight(!0);$(this).find("div.mce-reset > div.mce-container-body,div.mce-reset > div.mce-container-body > div.mce-container,div.mce-reset > div.mce-container-body > div.mce-container > div.mce-container-body").width(c.size.width).height(c.size.height-b);b=0;b=$(this).find(".mce-foot").width();$(this).find("div.mce-foot").width(c.size.width).children(":first").width(c.size.width);
		b>c.size.width?(b-=c.size.width,$(this).find("div.mce-foot .mce-btn").css({left:"-="+b})):(b=c.size.width-b,$(this).find("div.mce-foot .mce-btn").css({left:"+="+b}));m()},stop:function(d,c){var b=$(this).find(".mce-window-head").outerHeight(!0)+$(this).find(".mce-foot").outerHeight(!0);$(this).find("div.mce-reset > div.mce-container-body,div.mce-reset > div.mce-container-body > div.mce-container,div.mce-reset > div.mce-container-body > div.mce-container > div.mce-container-body").width(c.size.width).height(c.size.height-
		b);$(this).find(".mce-foot").width(c.size.width).children(":first").width(c.size.width);m()}})},100)}function u(d){var c=$("#htmlSource");if("undefined"==typeof window.ace)Loader.require("../../../../../Vendor/ace/htmlhint ../../../../../Vendor/ace/ace ../../../../../Vendor/ace/ext-chromevox ../../../../../Vendor/ace/ext-elastic_tabstops_lite ../../../../../Vendor/ace/ext-emmet ../../../../../Vendor/ace/emmet ../../../../../Vendor/ace/jshint ../../../../../Vendor/ace/csslint ../../../../../Vendor/ace/ext-keybinding_menu ../../../../../Vendor/ace/ext-language_tools ../../../../../Vendor/ace/ext-modelist ../../../../../Vendor/ace/ext-settings_menu ../../../../../Vendor/ace/ext-static_highlight ../../../../../Vendor/ace/ext-themelist ../../../../../Vendor/ace/ext-whitespace ../../../../../Vendor/ace/worker-javascript ../../../../../Vendor/ace/worker-php ../../../../../Vendor/ace/keybinding-emacs ../../../../../Vendor/ace/keybinding-vim ../../../../../Vendor/ace/theme-netbeans ../../../../../Vendor/ace/mode-html ../../../../../public/html/js/backend/dcms.config ../../../../../public/html/js/backend/tpleditor/dcms.ace.token_tooltip ../../../../../public/html/js/backend/tpleditor/dcms.ace.intellisense".split(" "),
	function(){if(!c.data("ace")){Config.set("fullscreenContainerId",$("#htmlSource").parent().attr("id"));var b=c.attr("id"),a="ace-"+(b?b:c.attr("name").replace("[","_").replace("]","_"))+"ace";c.parent().css({position:"relative"});b=c.parent().height();180>b&&(b=220);$('<div id="'+a+'" />').css({height:b}).insertBefore(c);$("#"+a).wrap($('<div id="'+a+'-wrapper"/>').addClass("ace-wrapper"));b=new AceEdit;b.init(a,c,$("#htmlSource").parent());b.reindentCode();c.attr("aceid",a).data("ace",b);var d=$("#"+
		a+"-wrapper").get(0),a=$("#"+a).get(0),p=$("#htmlSource").parent().find("div.ace-status-bar");c.data("aceElements",{wrapper:d,aceContainer:a,aceStatusBar:p});$("#htmlSource").data("ace",b);m()}});else if(!c.data("ace")){d=c.attr("id");var b="ace-"+(d?d:c.attr("name").replace("[","_").replace("]","_"))+"ace";c.parent().css({position:"relative"});d=c.parent().height();180>d&&(d=220);$('<div id="'+b+'" />').css({height:d}).insertBefore(c);$("#"+b).wrap($('<div id="'+b+'-wrapper"/>').addClass("ace-wrapper"));
	d=new AceEdit;d.init(b,c,$("#htmlSource").parent());d.reindentCode();c.attr("aceid",b).data("ace",d);var a=$("#"+b+"-wrapper").get(0),b=$("#"+b).get(0),p=$("#htmlSource").parent().find("div.ace-status-bar");c.data("aceElements",{wrapper:a,aceContainer:b,aceStatusBar:p});$("#htmlSource").data("ace",d);m()}}function m(){var a=$("#htmlSource"),c=a.parent();if(0!=a.length){var b=window.parent.document.body;a.each(function(){var a=$(this).data("ace"),d=$(this).data("aceElements");if(a&&"undefined"!=typeof a.editor&&
	d){var e=a.editor;if(e&&!a.fullscreen){var g=c.width(),h=c.height(),f=0,k=a.jqErrorBar;k&&k.is(":visible")&&(f=k.outerHeight(!0));1===d.aceStatusBar.length&&(f+=parseInt(d.aceStatusBar.outerHeight(!0),10));d.wrapper.style.width=g+"px";d.wrapper.style.height=h+"px";d.aceContainer.style.width=g+"px";d.aceContainer.style.height=h-f+"px";e.focus();e.renderer&&(e.renderer.onResize(!0),e.renderer.updateFull());a.refreshAfterResize()}else e&&a.fullscreen&&(b?(g=$(window.parent.window).width(),h=$(window.parent.window).height()):
	(g=$(window).width(),h=$(window).height()),f=0,(k=a.jqErrorBar)&&k.is(":visible")&&(f=k.outerHeight(!0)),1===d.aceStatusBar.length&&(f+=parseInt(d.aceStatusBar.outerHeight(!0),10)),d.wrapper.style.width=g+"px",d.wrapper.style.height=h+"px",d.aceContainer.style.width=g+"px",d.aceContainer.style.height=h-f+"px",e.focus(),e.renderer&&(e.renderer.onResize(!0),e.renderer.updateFull()),a.refreshAfterResize())}})}}var s=!1,l=[];a.windowManager.baseclose=a.windowManager.close;a.windowManager.close=function(){q()&&
(a.windowManager.close=a.windowManager.baseclose,a.windowManager.baseclose=null,t(void 0,void 0),r(),q().close())};a.addCommand("mceCodeEditor",n);a.addButton("code",{icon:"code",tooltip:"Source code",onclick:n});a.addMenuItem("code",{icon:"code",text:"Source code",context:"tools",onclick:n})});